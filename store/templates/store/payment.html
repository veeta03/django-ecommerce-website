{% extends 'base.html' %}
{% block content %}
{% csrf_token %}


<h3 class="mt-5 text-center">Complete Payment</h3>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<button id="rzp-button" class="btn btn-dark w-100 mt-4">
    Pay Now
</button>

<script>
var options = {
    "key": "{{ razorpay_key }}",
    "amount": "{{ amount }}",
    "currency": "INR",
    "name": "MyStore",
    "description": "Order Payment",
    "order_id": "{{ razorpay_order_id }}",
    "handler": function (response) {

    var form = document.createElement("form");
    form.method = "POST";
    form.action = "/payment-success/";

    var csrf = document.createElement("input");
    csrf.type = "hidden";
    csrf.name = "csrfmiddlewaretoken";
    csrf.value = "{{ csrf_token }}";

    var order_id = document.createElement("input");
    order_id.type = "hidden";
    order_id.name = "razorpay_order_id";
    order_id.value = response.razorpay_order_id;

    var payment_id = document.createElement("input");
    payment_id.type = "hidden";
    payment_id.name = "razorpay_payment_id";
    payment_id.value = response.razorpay_payment_id;

    var signature = document.createElement("input");
    signature.type = "hidden";
    signature.name = "razorpay_signature";
    signature.value = response.razorpay_signature;

    form.appendChild(csrf);
    form.appendChild(order_id);
    form.appendChild(payment_id);
    form.appendChild(signature);

    document.body.appendChild(form);
    form.submit();
}

};

var rzp = new Razorpay(options);

document.getElementById('rzp-button').onclick = function(e){
    rzp.open();
    e.preventDefault();
}
</script>

{% endblock %}
